<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel="stylesheet" type="text/css" href="mainStation.css">

    <script src="./node_modules/web3/dist/web3.min.js"></script>

</head>

<body>
    <div class="container">
        <div data-role="page" id="loginpage">
            <div id="header" data-theme="b" data-role="header">
                <h3>Register</h3>
            </div>
            <div id="wrapper">
                <form action="" name="myregister">
                    <div data-role="content">

                        <div data-role="fieldcontain">
                            <input name="input_userWalletAddress" id="field-userWalletAddress" placeholder="enter user wallet address"
                                type="text">
                        </div>

                        <div data-role="fieldcontain">
                            <input name="input_userName" id="field-userName" placeholder="enter username" type="text">
                        </div>

                        <div data-role="fieldcontain">
                            <input name="input_userPassword" id="field-password" placeholder="enter password" type="password">
                        </div>

                        <div data-role="fieldcontain">
                            <select id="field-userType">
                                <option value="EnergyProducer">EnergyProducer</option>
                                <option value="EnergyGridOperator">EnergyGridOperator</option>
                                <option value="EnergyTrader">EnergyTrader</option>
                                <option value="EnergyStation">EnergyStation</option>
                            </select>
                        </div>

                        <div data-role="fieldcontain">
                            <input id="btnRegister" value="Register" type="button" name="Register" onclick="userRegister();">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script>
        function userRegister() {
            try {
                var _userWalletAddress = document.getElementById('field-userWalletAddress').value;
                var _userName = document.getElementById('field-userName').value;
                var _userPassword = document.getElementById('field-password').value;
                // Html select tag definition for selected user type.
                var e = document.getElementById("field-userType");
                var userType = e.options[e.selectedIndex].value;

                // If user wallet address is empty, focus this field.
                if (_userWalletAddress == "") {
                    console.log('please enter user wallet address');
                    document.myregister.input_userWalletAddress.focus();
                }
                // If user name is empty, focus this field.
                else if (_userName == "") {
                    console.log('please enter username');
                    document.myregister.input_userName.focus();
                }
                // If user password is empty, focus this field.
                else if (_userPassword == "") {
                    console.log('please enter password');
                    document.myregister.input_userPassword.focus();
                }
                else {
                    if (typeof web3 !== 'undefined') {
                        web3 = new Web3(web3.currentProvider);
                    } else {
                        // Set the provider you want from Web3.providers.
                        web3 = new Web3(new Web3.providers.HttpProvider("HTTP://localhost:7545"));
                    }
                    // Default account defination.
                    web3.eth.defaultAccount = web3.eth.accounts[0];
                    // Initialize contract with its ABI.
                    var myContract = web3.eth.contract([{"constant":false,"inputs":[],"name":"Time_call","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_userName","type":"string"},{"name":"_userPassworde","type":"string"}],"name":"checkUserLogin","outputs":[{"name":"","type":"string"},{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_userWalletAdress","type":"string"},{"name":"_userName","type":"string"},{"name":"_userPassworde","type":"string"},{"name":"_userType","type":"string"}],"name":"userRegister","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_userName","type":"string"}],"name":"getUserLogLength","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"adminLogLength","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"adminLogStruct","outputs":[{"name":"userWalletAdress","type":"string"},{"name":"userName","type":"string"},{"name":"userType","type":"string"},{"name":"time","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"userInfoStruct","outputs":[{"name":"userWalletAdress","type":"string"},{"name":"userName","type":"string"},{"name":"userPassword","type":"string"},{"name":"userType","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_userName","type":"string"},{"name":"startIndex","type":"uint256"}],"name":"getUserLog","outputs":[{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);
                    // Contract defination of smart deployed contract with its address.
                    var SContract = myContract.at('0x821a3e26c19eeade712ea2c511e346779e5ae81e');
                    // Contract userRegister function access with user information.
                    SContract.userRegister(_userWalletAddress, _userName, _userPassword, userType, { from: web3.eth.accounts[0], gas: 3000000 });
                    console.log("Success!");
                }
            } catch (e) {
                console.log(e);
            }
        }
    </script>

</body>

</html>