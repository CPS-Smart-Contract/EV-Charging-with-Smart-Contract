<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
	<link rel="stylesheet" type="text/css" href="mainGridOperator.css">
	<script src="./node_modules/web3/dist/web3.min.js"></script>
</head>

<body>
	<div data-role="page" id="loginpage">
		<div id="header" data-theme="b" data-role="header">
			<h3>Login</h3>
		</div>
		<div id="wrapper">
			<form id="form_id" name="mylogin" method="GET">
				<div data-role="content">
					<div class="username" data-role="fieldcontain">
						<label for="username"> Username </label>
						<input name="currUsername" id="field-username" placeholder="enter username" type="text">
					</div>
					<div class="psw" data-role="fieldcontain">
						<label for="psw"> Password </label>
						<input id="field-psw" placeholder="enter password" type="password">
					</div>
					<div data-role="fieldcontain">
						<input id="login" type="button" value="Login" onclick="validationcheck();">
					</div>

				</div>
			</form>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script>
		function validationcheck() {
			var username = document.getElementById("field-username").value;
			var password = document.getElementById("field-psw").value;

			// if html user name field is empty, focus this field.
			if (username == "") {
				console.log('please enter username');
			}
			// if html user password field is empty, focus this field. 
			else if (password == "") {
				console.log('please enter password');
			} else {
				try {
					if (typeof web3 !== 'undefined') {
						web3 = new Web3(web3.currentProvider);
					} else {
						// Set the provider you want from Web3.providers
						web3 = new Web3(new Web3.providers.HttpProvider("HTTP://localhost:7545"));
					}
					// Default account defination
					web3.eth.defaultAccount = web3.eth.accounts[0];
					// Initialize contract with its ABI
					var myContract = web3.eth.contract([{"constant":true,"inputs":[{"name":"_userName","type":"string"},{"name":"_userPassworde","type":"string"}],"name":"checkUserLogin","outputs":[{"name":"","type":"string"},{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_userWalletAdress","type":"string"},{"name":"_userName","type":"string"},{"name":"_userPassworde","type":"string"},{"name":"_userType","type":"string"}],"name":"userRegister","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"userInfoStruct","outputs":[{"name":"userWalletAdress","type":"string"},{"name":"userName","type":"string"},{"name":"userPassword","type":"string"},{"name":"userType","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);

					var SContract = myContract.at('0x451a0e06d4bc32d3f8d2b37e025d219f891bc822');
                    /* Contract checkUserLogin function access with username and password.
                       This function return user type and status.
                    */
					SContract.checkUserLogin(username, password, function (error, result) {
						if (!error) {
							// If status value is true, user direct related page.
							if (result[1] == true) {
								var actionName = result[0] + ".html";
								if (actionName != "") {
									console.log(actionName);
									document.getElementById("form_id").action = actionName;
									document.getElementById("form_id").submit();
								} else {
									alert("Please set form action");
								}
							}
							else {
								// If status value is false, return error.
								console.log(result[0]);
							}
						}
						else {
							console.error(error);
						}
					});
				} catch (e) {
					console.log(e);
				}
			}
		}
	</script>
</body>

</html>